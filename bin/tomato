#!/usr/bin/env php
<?php

require dirname(__DIR__) . '/vendor/autoload.php';

use Symfony\Component\Console\Application;
use Pimple\Container;
use Symfony\Component\Dotenv\Dotenv;
use Tomato\Service\Provider;
use Tomato\Command;

$dotEnv = new Dotenv();
$dotEnv->load(dirname(__DIR__) . '/.env');

$container = new Container();
$container->register(new Provider\ConfigServiceProvider());
$container->register(new Provider\GitServiceProvider());
$container->register(new Provider\CliServiceProvider());
$container->register(new Provider\ConsoleOutputServiceProvider());
$container->register(new Provider\GitCommandsProvider());

$app = new Application('Tomato', '0.1.0');
$app->addCommands([
    new Command\Deploy($container),
    $container['command:git:pullRequest'],
    $container['command:git:branch'],
    $container['command:git:merge'],
    $container['command:git:projects'],
    $container['command:git:tag'],
    $container['command:git:mergeDown'],
    new Command\Config($container),
]);
$app->run(null, $container['service:console-output']);
